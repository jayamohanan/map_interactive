
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kerala Local Body Interactive Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body, html { margin:0; padding:0; height:100%; }
  #map { width:100%; height:100%; }

  #localBodyName {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255,255,255,0.9);
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 20px;
    font-weight: bold;
    z-index: 1000;
  }
</style>
</head>
<body>

<div id="map"></div>
<div id="localBodyName">Click on a location to see local body</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<script>
let map = L.map('map').setView([10.5, 76.5], 7);

// Add OSM tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let geoFeatures = [];
let geoLayer = null;
let highlightedLayer = null;

// Load GeoJSON
fetch('local__bodies.geojson')
  .then(res => res.json())
  .then(data => {
    geoFeatures = data.features;

    // Draw polygons
    geoLayer = L.geoJSON(geoFeatures, {
      style: {
        color:'#2a63b8', 
        weight:1, 
        fillColor:'#8fb8ff', 
        fillOpacity:0.3
      }
    }).addTo(map);
  })
  .catch(err => {
    console.error(err);
    document.getElementById('localBodyName').textContent = "Error loading GeoJSON";
  });

// Handle map click
map.on('click', function(e){
  const point = [e.latlng.lng, e.latlng.lat]; // GeoJSON is [lng, lat]
  let found = null;

  for(const feat of geoFeatures){
    if(turf.booleanPointInPolygon(point, feat)){
      found = feat;
      break;
    }
  }

  if(found){
    const keys = ['name','NAME','Name','LGB_NAME','LB_NAME','local_body','LOCAL_BODY'];
    let localBodyName = 'Unknown';
    for(const k of keys){
      if(k in found.properties && found.properties[k]){
        localBodyName = found.properties[k];
        break;
      }
    }

    document.getElementById('localBodyName').textContent = localBodyName;

    // Highlight the selected polygon
    if(highlightedLayer) geoLayer.resetStyle(highlightedLayer);
    highlightedLayer = geoLayer.getLayers().find(l => l.feature === found);
    if(highlightedLayer) highlightedLayer.setStyle({fillColor:'yellow', fillOpacity:0.5});
  } else {
    document.getElementById('localBodyName').textContent = "Not inside any local body";
  }
});
</script>
</body>
</html>
